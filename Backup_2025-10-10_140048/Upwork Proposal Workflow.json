{
  "createdAt": "2025-10-08T15:12:37.170Z",
  "updatedAt": "2025-10-09T06:30:14.000Z",
  "id": "GRaQpF4jYbwCXS2j",
  "name": "Upwork Proposal Workflow",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1HGvs35BX2KUp2wwrdLIrLh9qiLj6nvsRFG_MCGZb7z0",
          "mode": "list",
          "cachedResultName": "Upwork data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HGvs35BX2KUp2wwrdLIrLh9qiLj6nvsRFG_MCGZb7z0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HGvs35BX2KUp2wwrdLIrLh9qiLj6nvsRFG_MCGZb7z0/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Is Applicable",
              "lookupValue": "Fit"
            }
          ]
        },
        "options": {
          "returnFirstMatch": true
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        208,
        160
      ],
      "id": "414e9666-1fd0-4df2-b322-0b67cd214132",
      "name": "Filters Fit Work",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ZG1MR4HwHasbUvb4",
          "name": "Cognigenai Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.0-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=Analyze the following job post and provide the requested JSON output:\nRow Number: {{ $json.row_number }}\nDescription: {{ $json.Description }}\nReason: {{ $json.Reason }}"
            },
            {
              "content": "=You are a classification model designed for an n8n workflow. Your task is to analyze job posts and determine if they are from a \"Client\" or an \"Agency\". The output must be a JSON object containing two fields: \"type\" with the classification result and \"row_number\" with the original row number provided in the input. Do not include any other text, conversation, or reasoning.",
              "role": "model"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        352,
        160
      ],
      "id": "7fefa4c3-3063-4e35-ad70-185bf7720ca3",
      "name": "Checks for client work",
      "credentials": {
        "googlePalmApi": {
          "id": "13GUWdzP5u5goYYi",
          "name": "Google Gemini(PaLM) Api account - Ansh"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        48,
        160
      ],
      "id": "04160668-a66a-4464-ba03-fc8ffd17c356",
      "name": "Manual Trigger"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "06baa048-723c-4ceb-8547-40e7882f51ae",
              "leftValue": "={{ $json.type }}",
              "rightValue": "Client",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        816,
        160
      ],
      "id": "3b436632-b7c9-4ec1-b6c7-790b057e6e67",
      "name": "Filters Client only Work"
    },
    {
      "parameters": {
        "jsCode": "// Get the output from the previous Gemini node\nconst geminiOutput = $input.first().json.content.parts[0].text;\n\n// ✅ NEW: Get the original job data from the first input\nconst originalData = $('Filters Fit Work').all()[0].json;\n\n// Use a regular expression to extract the JSON string\nconst jsonMatch = geminiOutput.match(/```json\\n([\\s\\S]*?)\\n```/);\n\nif (jsonMatch && jsonMatch[1]) {\n  // Parse the extracted JSON string\n  const parsedData = JSON.parse(jsonMatch[1]);\n\n  // ✅ NEW: Merge original data with classification result\n  return [{\n    json: {\n      ...originalData,  // ✅ Spread ALL original fields first\n      type: parsedData.type,\n      row_number: parsedData.row_number,\n    },\n  }];\n} else {\n  throw new Error(\"Could not find valid JSON in the Gemini output.\");\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        640,
        160
      ],
      "id": "6af17ad6-e237-4731-90f6-533ac88f66ba",
      "name": "Extracts Type & Row"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=Analyzed Job Data: {{ $json.content.parts[0].text }}\n\nOriginal Job Title: {{ $('Classify Template Type').item.json.Title }}"
            },
            {
              "content": "=You are an expert Google Ads proposal writer for an agency. Your task is to draft a highly personalized Upwork proposal that EXACTLY matches the structure and style of the template retrieved from Pinecone.\n\nCRITICAL UNDERSTANDING - Three Types of Content:\n\n1. **TEMPLATE (From Pinecone)**: Structure, style, formatting\n2. **INDUSTRY REFERENCES (From Pinecone IF NEEDED)**: Past client work, case studies\n3. **TECHNICAL EXPERIENCE (Generated by YOU)**: Google Ads expertise\n4. **QUESTION ANSWERS (From Pinecone IF NEEDED)**: Example answers to common questions\n\nSTEP 1 - RETRIEVE THE PROPOSAL TEMPLATE:\nUse the Pinecone tool to search for: \"proposal template google ads {template_type}\"\n\nBased on template_type:\n- \"audit\" → \"proposal template google ads audit\"\n- \"with_account\" → \"proposal template google ads optimization management\"\n- \"lead_gen_no_account\" → \"proposal template google ads setup lead generation\"\n\nThe template provides: structure, section headings, tone, style, paragraph format\nYou MUST follow this structure exactly.\n\nSTEP 2 - RETRIEVE INDUSTRY REFERENCES (IF NEEDED):\nCheck the analyzed data's \"needs_industry_reference\" field.\nIf it equals \"T\":\n  - Use Pinecone tool to search: \"case study {industry_category}\" or \"past client {industry_category}\"\n  - Extract relevant examples of past work in that industry\n  - Insert these naturally into the \"Relevant Experience\" section of the template\n\nSTEP 3 - RETRIEVE QUESTION ANSWER EXAMPLES (IF NEEDED):\nLook at the \"questions_to_answer\" array.\nFor each question where \"search_required\" is true:\n  - Use Pinecone tool with the provided \"search_query\"\n  - Retrieve example answers or approach frameworks\n  - Adapt these to answer the specific question\n\nSTEP 4 - GENERATE TECHNICAL EXPERIENCE CONTENT:\nFor the technical_experience_required from the analyzed data:\n  - Write compelling content about your Google Ads expertise\n  - Be specific about the skills they need (e.g., \"I have extensive experience with Performance Max campaigns, having managed $500k+ in ad spend across 20+ accounts\")\n  - This is NOT from Pinecone - you generate this based on your expertise\n  - Match the tone and style of the template\n\nSTEP 5 - FILL THE COMPLETE PROPOSAL:\nUsing the template structure, fill in:\n1. **Subject line**: Compelling and specific to their job title\n2. **Introduction**: Reference their core_problem\n3. **Problem Statement**: Restate their challenge\n4. **Proposed Solution**: Use proposed_first_steps, mention technical_experience_required\n5. **Relevant Experience**: \n   - IF industry references were retrieved from Pinecone → Insert them here\n   - Add your general Google Ads experience (generated content)\n6. **Answer Questions**: \n   - For each question in questions_to_answer:\n     * IF search_required was true → Use the retrieved answer examples as guidance\n     * Adapt and personalize the answer to their specific situation\n   - Number answers clearly (Q1, Q2, etc.)\n7. **Call to Action**: Use the call_to_action from analysis\n\nCRITICAL FORMATTING RULES:\n- Keep the EXACT section headings from the template\n- Keep the EXACT paragraph structure\n- Keep the EXACT tone and style (formal/casual/confident)\n- If template uses bullets, use bullets\n- If template uses paragraphs, use paragraphs\n- Match the template's length and detail level\n- Do NOT add sections not in the template\n- Do NOT remove sections from the template\n\nOUTPUT REQUIREMENTS:\n- Must start with \"Subject: [compelling subject line]\"\n- Follow template structure exactly\n- Insert all required content naturally\n- No explanations or commentary\n- Only the completed proposal text\n\nCONTENT SOURCE SUMMARY:\n✓ Template structure/style → FROM PINECONE (proposal template)\n✓ Industry references → FROM PINECONE IF needs_industry_reference=\"T\" (case studies)\n✓ Technical expertise → GENERATED BY YOU (based on technical_experience_required)\n✓ Question answers → FROM PINECONE IF search_required=true (answer examples)"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        1632,
        48
      ],
      "id": "12af53f4-287a-43a6-8d5f-d57ee1d5a14c",
      "name": "Draft Proposal",
      "credentials": {
        "googlePalmApi": {
          "id": "13GUWdzP5u5goYYi",
          "name": "Google Gemini(PaLM) Api account - Ansh"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=You are an expert in analyzing Upwork job postings for a Google Ads agency.\n\nYour task is to analyze the job posting and determine:\n1. Does this job require specific industry experience or past client references?\n2. What technical Google Ads experience is needed?\n3. Are there questions that need to be answered?\n4. Do any questions require searching for past answer examples?\n\nJob Details:\nTitle: {{ $json.Title }}\nJob Description: {{ $json.Description }}\nDuration: {{ $json.Duration }}\nRequired Experience Level: {{ $json['Experience Level'] }}\nCategory: {{ $json.Category }} \nSub Category: {{ $json.SubCategory }}\nReason: {{ $json.Reason }}\nTemplate Type: {{ $json.template_type }}\nService Description: {{ $json.service_description }}\n\nClient Questions:\n1. {{ $json['Question 1'] }}\n2. {{ $json['Question 2'] }}\n3. {{ $json['Question 3'] }}\n4. {{ $json['Question 4'] }}\n5. {{ $json['Question 5'] }}\n6. {{ $json['Other Questions'] }}\n\nHourly min budget: {{ $json.hourlyBudgetMin }}\nHourly max budget: {{ $json.hourlyBudgetMax }}\nWeekly Budget: {{ $json.weeklyBudget }}\n\nCRITICAL ANALYSIS INSTRUCTIONS:\n\n**Industry Reference Detection:**\n- Look for questions like: \"Describe your recent experience with similar projects\", \"Have you worked with [industry] companies?\", \"Share examples from [sector]\", \"Do you have experience in our industry?\"\n- Look in the description for industry-specific requirements: healthcare, e-commerce, SaaS, legal, real estate, etc.\n- If ANY question asks about past work, similar projects, or industry experience → set needs_industry_reference to \"T\"\n\n**Technical Experience Detection:**\n- Identify what Google Ads skills they need: keyword research, conversion tracking, Shopping campaigns, Performance Max, remarketing, GA4, GTM, etc.\n- This will be written by the LLM (NOT searched in Pinecone)\n\n**Question Analysis:**\n- List ALL non-empty questions\n- For EACH question, determine if it needs a Pinecone search or can be answered directly\n- Questions that need Pinecone search examples:\n  * \"What tools do you use for keyword research?\"\n  * \"Describe your process for optimizing campaigns\"\n  * \"What's your approach to reducing CPC?\"\n  * \"How do you handle low conversion rates?\"\n- These need search_required: true\n\nProvide your analysis output in this JSON format:\n{\n  \"needs_industry_reference\": \"T/F\",\n  \"industry_category\": \"specific industry from description or questions (e.g., 'healthcare', 'e-commerce', 'SaaS', 'legal') or 'general digital marketing'\",\n  \"technical_experience_required\": \"list of technical Google Ads skills needed (keyword research, conversion tracking, Shopping campaigns, Performance Max, GA4, GTM, etc.)\",\n  \"questions_to_answer\": [\n    {\n      \"question\": \"full question text\",\n      \"search_required\": true/false,\n      \"search_query\": \"what to search in Pinecone if search_required is true\"\n    }\n  ],\n  \"core_problem\": \"brief statement of the client's main challenge\",\n  \"proposed_first_steps\": \"specific actionable steps based on template type and their needs\",\n  \"call_to_action\": \"clear closing statement inviting next steps\",\n  \"template_type\": \"{{ $json.template_type }}\"\n}"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        1280,
        -64
      ],
      "id": "d1fbce6b-a5db-49c5-9f33-1c9ab4350e92",
      "name": "Analyze Job Data",
      "credentials": {
        "googlePalmApi": {
          "id": "13GUWdzP5u5goYYi",
          "name": "Google Gemini(PaLM) Api account - Ansh"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get the output from the previous Gemini node\nconst rawOutputText = $input.first().json.content.parts[0].text;\n\n// Try multiple patterns to find the proposal\nlet proposalText = null;\n\n// Pattern 1: Look for \"Subject:\" (case insensitive)\nlet match = rawOutputText.match(/Subject:[\\s\\S]*/i);\nif (match && match[0]) {\n  proposalText = match[0].trim();\n}\n\n// Pattern 2: If no Subject found, try \"SUBJECT:\"\nif (!proposalText) {\n  match = rawOutputText.match(/SUBJECT:[\\s\\S]*/i);\n  if (match && match[0]) {\n    proposalText = match[0].trim();\n  }\n}\n\n// Pattern 3: Remove markdown code blocks and use the clean text\nif (!proposalText) {\n  // Remove ```markdown or ```text blocks\n  proposalText = rawOutputText.replace(/```[a-z]*\\n?([\\s\\S]*?)```/gi, '$1').trim();\n  \n  // If it still doesn't start with Subject, add a default one\n  if (!proposalText.toLowerCase().startsWith('subject:')) {\n    const jobTitle = $('Classify Template Type').item.json.Title || 'Your Project';\n    proposalText = `Subject: Experienced Google Ads Specialist for ${jobTitle}\\n\\n${proposalText}`;\n  }\n}\n\n// Final validation\nif (!proposalText || proposalText.length < 50) {\n  throw new Error(`Invalid proposal generated. Raw output: ${rawOutputText.substring(0, 200)}...`);\n}\n\n// Return the clean proposal\nreturn [{\n  json: {\n    proposal_text: proposalText,\n    char_count: proposalText.length,\n    has_subject_line: proposalText.toLowerCase().includes('subject:')\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2176,
        64
      ],
      "id": "23786bee-652e-4f86-8e58-1295f2f352c2",
      "name": "Parse Json"
    },
    {
      "parameters": {
        "content": "# Analyzes Job Posting and Designs Proposal using RAG",
        "height": 624,
        "width": 2800,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -80,
        -128
      ],
      "typeVersion": 1,
      "id": "2cb4d46f-d3a8-49ee-bd0c-67b01b63aa1b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1ggjqBgOwauhTeNpL6U4VTxlIZmPtOED2",
          "mode": "list",
          "cachedResultName": "Upwork Proposal Reference Docs",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1ggjqBgOwauhTeNpL6U4VTxlIZmPtOED2"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        880,
        672
      ],
      "id": "1ac69e6c-208f-4edc-ae1f-3cd6e98c734e",
      "name": "Google Drive Trigger",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "aclEYLTf0xLCPc7g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1056,
        672
      ],
      "id": "a4b7a503-3dd0-4abe-9f85-26d39e80ba76",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "aclEYLTf0xLCPc7g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "textSplittingMode": "custom",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        1344,
        848
      ],
      "id": "78a3a54a-c4f2-4221-ba21-3a2f867a57e9",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        1408,
        976
      ],
      "id": "4f35c643-12d0-4e74-a5f9-81f7d68948d2",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "content": "# Saves Past Company and template data for RAG",
        "height": 624,
        "width": 1296,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        608,
        576
      ],
      "typeVersion": 1,
      "id": "c8f95b9b-c096-4eda-aaa1-13e6da4b1dc8",
      "name": "Sticky Note"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        1184,
        944
      ],
      "id": "fe9a0235-a005-4c14-b5a5-18761caab3b4",
      "name": "Embeddings Google Gemini1",
      "credentials": {
        "googlePalmApi": {
          "id": "13GUWdzP5u5goYYi",
          "name": "Google Gemini(PaLM) Api account - Ansh"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1HGvs35BX2KUp2wwrdLIrLh9qiLj6nvsRFG_MCGZb7z0",
          "mode": "list",
          "cachedResultName": "Upwork data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1HGvs35BX2KUp2wwrdLIrLh9qiLj6nvsRFG_MCGZb7z0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1EyqhQ9WEeuq0shMHDUZdpWMx32Ns7ioLkSqT2ecYf60/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $('Classify Template Type').item.json.row_number }}",
            "Proposal Link": "={{ $json.url }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Datum I Vreme Pokretanja Aplikacije",
              "displayName": "Datum I Vreme Pokretanja Aplikacije",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "URL",
              "displayName": "URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Title",
              "displayName": "Title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Description",
              "displayName": "Description",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Duration",
              "displayName": "Duration",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Experience Level",
              "displayName": "Experience Level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Category",
              "displayName": "Category",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "SubCategory",
              "displayName": "SubCategory",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Client.TotalHires",
              "displayName": "Client.TotalHires",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Client.TotalPostedJobs",
              "displayName": "Client.TotalPostedJobs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Client.TotalReviews",
              "displayName": "Client.TotalReviews",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Client.TotalFeedback",
              "displayName": "Client.TotalFeedback",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Is Applicable",
              "displayName": "Is Applicable",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reason",
              "displayName": "Reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Question 1",
              "displayName": "Question 1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Question 2",
              "displayName": "Question 2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Question 3",
              "displayName": "Question 3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Question 4",
              "displayName": "Question 4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Question 5",
              "displayName": "Question 5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Other Questions",
              "displayName": "Other Questions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Publish Date",
              "displayName": "Publish Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Client.TotalSpent",
              "displayName": "Client.TotalSpent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hourlyBudgetMin",
              "displayName": "hourlyBudgetMin",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hourlyBudgetMax",
              "displayName": "hourlyBudgetMax",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "weeklyBudget",
              "displayName": "weeklyBudget",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Proposal Link",
              "displayName": "Proposal Link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2512,
        64
      ],
      "id": "6fe8b33d-9b41-4a97-89ae-12bbffb5c54c",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ZG1MR4HwHasbUvb4",
          "name": "Cognigenai Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://md2doc.n8n.aemalsayer.com",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleDriveOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "fileName",
              "value": "=Proposal for {{ $('Classify Template Type').item.json.Title }}"
            },
            {
              "name": "output",
              "value": "={{ $json.proposal_text }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2336,
        64
      ],
      "id": "cc07a7b6-2187-4b49-8200-8fd590411b98",
      "name": "DOC CREATOR",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "aclEYLTf0xLCPc7g",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "pineconeIndex": {
          "__rl": true,
          "value": "cgragtest",
          "mode": "list",
          "cachedResultName": "cgragtest"
        },
        "options": {
          "pineconeNamespace": "Upwork Proposal Reference"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        1232,
        672
      ],
      "id": "bee127d8-18a4-470c-9dc1-1e1cde9ec82e",
      "name": "Insert Data",
      "credentials": {
        "pineconeApi": {
          "id": "aWTuoJ6ldBZ2gPsm",
          "name": "PineconeApi account - cognigenai"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "This tool provides access to a database of past client work, case studies, and proposal templates. Use this tool when you need to find relevant experience to showcase in a proposal or to retrieve a specific proposal template. You can search for client references based on industry or find the correct template for a Google Ads-related job.",
        "pineconeIndex": {
          "__rl": true,
          "value": "cgragtest",
          "mode": "list",
          "cachedResultName": "cgragtest"
        },
        "options": {
          "pineconeNamespace": "Upwork Proposal Reference"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        2016,
        368
      ],
      "id": "def04e7e-a3a4-4aa8-9697-9b59e702daee",
      "name": "Pinecone Vector Store - Query Data",
      "credentials": {
        "pineconeApi": {
          "id": "aWTuoJ6ldBZ2gPsm",
          "name": "PineconeApi account - cognigenai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Determine proposal template type based on job description\nconst description = ($json.Description || '').toLowerCase();\nconst title = ($json.Title || '').toLowerCase();\nconst reason = ($json.Reason || '').toLowerCase();\nconst combined = `${title} ${description} ${reason}`;\n\n// Priority 1: Check for AUDIT specifically (least common, check first)\nconst auditKeywords = ['audit', 'review our', 'assess our', 'evaluate our', 'analyze our current'];\nconst isAudit = auditKeywords.some(keyword => combined.includes(keyword));\n\nif (isAudit) {\n  return [{\n    json: {\n      ...$json,\n      template_type: 'audit',\n      service_description: 'Google Ads Audit'\n    }\n  }];\n}\n\n// Priority 2: Check if they DON'T have an account (setup/new campaign indicators)\nconst noAccountKeywords = [\n  'set up', 'setup', 'create campaign', 'launch campaign', \n  'new campaign', 'start campaign', 'build campaign',\n  'no google ads', 'never used', 'not using', 'want to start',\n  'need to start', 'begin google ads', 'starting google ads'\n];\n\nconst needsSetup = noAccountKeywords.some(keyword => combined.includes(keyword));\n\nif (needsSetup) {\n  return [{\n    json: {\n      ...$json,\n      template_type: 'lead_gen_no_account',\n      service_description: 'Google Ads Setup & Lead Generation'\n    }\n  }];\n}\n\n// Priority 3: DEFAULT - Assume they HAVE an account (most common case)\n// This includes: optimize, manage, improve, scale, or just general \"need help with Google Ads\"\nreturn [{\n  json: {\n    ...$json,\n    template_type: 'with_account',\n    service_description: 'Google Ads Optimization & Management'\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1024,
        64
      ],
      "id": "42e2a9ce-832b-4cea-8e8e-56351b36796e",
      "name": "Classify Template Type"
    },
    {
      "parameters": {
        "jsCode": "// Get the proposal and analyzed data with error handling\ntry {\n  const proposalInput = $input.first().json;\n  \n  // Handle different possible structures for proposal content\n  let proposal = '';\n  if (proposalInput.content && proposalInput.content.parts && proposalInput.content.parts[0]) {\n    proposal = proposalInput.content.parts[0].text.toLowerCase();\n  } else if (proposalInput.text) {\n    proposal = proposalInput.text.toLowerCase();\n  } else {\n    console.warn('⚠️ Could not extract proposal text from input');\n    return $input.all();\n  }\n\n  // Get analyzed data with error handling\n  const analyzeJobDataOutput = $('Analyze Job Data').first().json;\n  let analyzedData = {};\n  \n  if (analyzeJobDataOutput.content && analyzeJobDataOutput.content.parts && analyzeJobDataOutput.content.parts[0]) {\n    try {\n      analyzedData = JSON.parse(analyzeJobDataOutput.content.parts[0].text);\n    } catch (parseError) {\n      console.warn('⚠️ Could not parse analyzed data JSON:', parseError.message);\n      return $input.all();\n    }\n  } else {\n    console.warn('⚠️ Could not find analyzed data');\n    return $input.all();\n  }\n\n  const questions = analyzedData.questions_to_answer || [];\n\n  // Validation checks\n  const validations = {\n    has_subject: proposal.includes('subject:'),\n    has_introduction: proposal.length > 200,\n    questions_addressed: []\n  };\n\n  // Check if questions are addressed\n  if (questions.length > 0) {\n    questions.forEach((question, index) => {\n      // Handle both string and object format for questions\n      const questionText = typeof question === 'string' ? question : (question.question || '');\n      \n      if (!questionText) {\n        return; // Skip empty questions\n      }\n      \n      // Extract key words from question (words longer than 4 chars)\n      const keywords = questionText.toLowerCase()\n        .split(' ')\n        .filter(word => word.length > 4 && !['what', 'how', 'when', 'where', 'which', 'describe', 'please'].includes(word));\n      \n      // Check if at least 2 keywords appear in the proposal\n      const keywordsFound = keywords.filter(keyword => proposal.includes(keyword));\n      const isAddressed = keywordsFound.length >= Math.min(2, keywords.length);\n      \n      validations.questions_addressed.push({\n        question_num: index + 1,\n        question: questionText.substring(0, 50) + '...',\n        is_addressed: isAddressed,\n        keywords_found: keywordsFound.length,\n        keywords_total: keywords.length\n      });\n    });\n  }\n\n  // Check if industry reference was needed and provided\n  if (analyzedData.needs_industry_reference === 'T') {\n    const industry = (analyzedData.industry_category || '').toLowerCase();\n    validations.industry_reference_included = proposal.includes(industry) || \n      proposal.includes('similar') || \n      proposal.includes('experience') || \n      proposal.includes('worked with');\n  }\n\n  // Count potential issues\n  const issues = [];\n  if (!validations.has_subject) issues.push('Missing Subject line');\n  if (validations.questions_addressed.length > 0) {\n    const unanswered = validations.questions_addressed.filter(q => !q.is_addressed);\n    if (unanswered.length > 0) {\n      issues.push(`${unanswered.length} question(s) may not be fully addressed`);\n    }\n  }\n  if (analyzedData.needs_industry_reference === 'T' && !validations.industry_reference_included) {\n    issues.push('Industry reference needed but may be missing');\n  }\n\n  // Log validation results\n  console.log('✅ Proposal Validation:', {\n    validations,\n    issues,\n    proposal_length: proposal.length\n  });\n\n  if (issues.length > 0) {\n    console.warn('⚠️ Proposal Issues Found:', issues);\n  } else {\n    console.log('✅ All validation checks passed!');\n  }\n\n  // Pass through the original data\n  return $input.all();\n  \n} catch (error) {\n  console.error('❌ Validation Error:', error.message);\n  console.log('Skipping validation and passing data through...');\n  // Don't fail the workflow, just pass the data through\n  return $input.all();\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1968,
        48
      ],
      "id": "cfcf56cd-9dc5-49c1-be29-e7921a4cce04",
      "name": "Validate Proposal"
    }
  ],
  "connections": {
    "Filters Fit Work": {
      "main": [
        [
          {
            "node": "Checks for client work",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Checks for client work": {
      "main": [
        [
          {
            "node": "Extracts Type & Row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Filters Fit Work",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extracts Type & Row": {
      "main": [
        [
          {
            "node": "Filters Client only Work",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Job Data": {
      "main": [
        [
          {
            "node": "Draft Proposal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Draft Proposal": {
      "main": [
        [
          {
            "node": "Validate Proposal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Json": {
      "main": [
        [
          {
            "node": "DOC CREATOR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive Trigger": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Insert Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Insert Data",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini1": {
      "ai_embedding": [
        [
          {
            "node": "Insert Data",
            "type": "ai_embedding",
            "index": 0
          },
          {
            "node": "Pinecone Vector Store - Query Data",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "DOC CREATOR": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store - Query Data": {
      "ai_tool": [
        [
          {
            "node": "Draft Proposal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Filters Client only Work": {
      "main": [
        [
          {
            "node": "Classify Template Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Classify Template Type": {
      "main": [
        [
          {
            "node": "Analyze Job Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Proposal": {
      "main": [
        [
          {
            "node": "Parse Json",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "70a8d3d1-3531-4876-a22f-3850f35b0e26",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-10-08T15:12:37.175Z",
      "updatedAt": "2025-10-08T15:12:37.175Z",
      "role": "workflow:owner",
      "workflowId": "GRaQpF4jYbwCXS2j",
      "projectId": "nnULjHyqOVknXpmc"
    }
  ],
  "tags": []
}